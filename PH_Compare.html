<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Placeholder Validator</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    body {
      font-family: 'Montserrat', sans-serif;
      padding: 20px;
      background-color: white;
      color: black;
      transition: background-color 0.3s, color 0.3s;
    }
    .title {
      text-align: left;
      font-weight: 700;
      margin-bottom: 20px;
      font-size: 24px;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 10px;
      font-family: 'Montserrat', sans-serif;
    }
    .textareas {
      display: flex;
      gap: 20px;
    }
    .textareas > div {
      flex: 1;
    }
    #compareBtn {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      background: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      font-size: 16px;
      font-family: 'Montserrat', sans-serif;
    }
    #compareBtn:hover {
      background: #0056b3;
    }
    .tables-container {
      display: flex;
      justify-content: flex-start;
      gap: 20px;
      margin-top: 20px;
      align-items: flex-start;
    }
    .tables-container.centered {
      justify-content: center;
    }
    table {
      border-collapse: collapse;
      table-layout: auto;
      font-family: 'Montserrat', sans-serif;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    .mismatch {
      background-color: #ffcccc;
    }
    #matchStatus {
      font-size: 24px;
      margin: 20px 0;
      text-align: center;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h3 class="title">Placeholder Validator</h3>
  <div class="textareas">
    <div>
      <h3>Original Build</h3>
      <textarea id="dataInput1" placeholder="Paste original build data here..."></textarea>
    </div>
    <div>
      <h3>Placeholder</h3>
      <textarea id="dataInput2" placeholder="Paste placeholder build data here..."></textarea>
    </div>
  </div>

  <button id="compareBtn">Compare Builds</button>
  <div id="matchStatus"></div>

  <div class="tables-container">
    <table id="comparisonTable" style="display: none;">
      <thead><tr><th>Attribute</th><th>Original</th><th>Placeholder</th></tr></thead>
      <tbody></tbody>
    </table>
    <table id="mismatchDetailsTable" style="display: none;">
      <thead><tr><th>Non-matching Attribute</th><th>Original</th><th>Placeholder</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    document.getElementById('compareBtn').addEventListener('click', compareBuilds);

    function parseAttributes(data) {
      const attributes = {};
      const extraFields = ['Position','Archetype','Height','Weight','Wingspan'];
      data.trim().split('\n').forEach(line => {
        if (!line) return;
        const parts = line.trim().split(/\t+/);
        const key = parts[0] === 'Potential Description' ? 'Archetype' : parts[0];
        const numbers = parts.filter(p => /^\d+$/.test(p));
        if (numbers.length >= 2) {
          attributes[key] = numbers[1];
        } else if (parts.length === 2 && extraFields.includes(key)) {
          attributes[key] = parts[1];
        }
      });
      return attributes;
    }

    function compareBuilds() {
      const attr1 = parseAttributes(document.getElementById('dataInput1').value);
      const attr2 = parseAttributes(document.getElementById('dataInput2').value);
      const extraOrder = ['Position','Archetype','Height','Weight','Wingspan'];
      const allKeys = Array.from(new Set([...Object.keys(attr1), ...Object.keys(attr2)]));
      const orderedKeys = [...extraOrder.filter(f => allKeys.includes(f)), ...allKeys.filter(k => !extraOrder.includes(k)).sort()];

      // Populate comparison table
      const compBody = document.querySelector('#comparisonTable tbody');
      compBody.innerHTML = '';
      let allMatch = true;
      const compFrag = document.createDocumentFragment();
      orderedKeys.forEach(key => {
        const val1 = attr1[key] || '';
        const val2 = attr2[key] || '';
        const row = document.createElement('tr');
        if (val1 !== val2) {
          row.classList.add('mismatch');
          allMatch = false;
        }
        row.innerHTML = `<td>${key}</td><td>${val1}</td><td>${val2}</td>`;
        compFrag.appendChild(row);
      });
      compBody.appendChild(compFrag);
      document.getElementById('comparisonTable').style.display = 'table';
      document.getElementById('matchStatus').innerHTML = allMatch
        ? '<span style="color:green; font-weight:bold;">✔ MATCH</span>'
        : '<span style="color:red; font-weight:bold;">✘ NOT MATCHING</span>';

      // Handle container centering on full match
      const container = document.querySelector('.tables-container');
      if (allMatch) {
        container.classList.add('centered');
      } else {
        container.classList.remove('centered');
      }

      // Populate mismatch details table
      const detailsBody = document.querySelector('#mismatchDetailsTable tbody');
      detailsBody.innerHTML = '';
      if (!allMatch) {
        const detailsFrag = document.createDocumentFragment();
        orderedKeys.forEach(key => {
          const val1 = attr1[key] || '';
          const val2 = attr2[key] || '';
          if (val1 !== val2) {
            const detailRow = document.createElement('tr');
            detailRow.innerHTML = `<td>${key}</td><td>${val1}</td><td>${val2}</td>`;
            detailsFrag.appendChild(detailRow);
          }
        });
        detailsBody.appendChild(detailsFrag);
        document.getElementById('mismatchDetailsTable').style.display = 'table';
      } else {
        document.getElementById('mismatchDetailsTable').style.display = 'none';
      }
    }
  </script>
</body>
</html>
